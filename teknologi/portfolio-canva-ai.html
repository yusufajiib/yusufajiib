<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Karya AI Siswa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .modal-backdrop { backdrop-filter: blur(5px); }
        
        /* Colorful Category Badges */
        .category-gambar { background: linear-gradient(135deg, #ff6b6b, #ffa726); color: white; }
        .category-teks { background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; }
        .category-video { background: linear-gradient(135deg, #a8edea, #fed6e3); color: #333; }
        .category-musik { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        
        /* Colorful Card Borders & Backgrounds */
        .card-gambar { 
            border: 3px solid transparent;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            background-clip: padding-box;
            box-shadow: 0 8px 32px rgba(255, 107, 107, 0.3);
            position: relative;
        }
        .card-gambar::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            border-radius: inherit;
            z-index: -1;
            margin: -3px;
        }
        
        .card-teks { 
            border: 3px solid transparent;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            background-clip: padding-box;
            box-shadow: 0 8px 32px rgba(78, 205, 196, 0.3);
            position: relative;
        }
        .card-teks::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
            border-radius: inherit;
            z-index: -1;
            margin: -3px;
        }
        
        .card-video { 
            border: 3px solid transparent;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-clip: padding-box;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
            position: relative;
        }
        .card-video::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: inherit;
            z-index: -1;
            margin: -3px;
        }
        
        .card-musik { 
            border: 3px solid transparent;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            background-clip: padding-box;
            box-shadow: 0 8px 32px rgba(252, 182, 159, 0.3);
            position: relative;
        }
        .card-musik::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, #ff9a9e, #fad0c4);
            border-radius: inherit;
            z-index: -1;
            margin: -3px;
        }
        
        /* Card Content Backgrounds */
        .card-content-gambar {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 245, 245, 0.9));
            backdrop-filter: blur(10px);
        }
        .card-content-teks {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 253, 252, 0.9));
            backdrop-filter: blur(10px);
        }
        .card-content-video {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
            backdrop-filter: blur(10px);
        }
        .card-content-musik {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 248, 240, 0.9));
            backdrop-filter: blur(10px);
        }
        
        /* Pagination Styles */
        .pagination-btn {
            transition: all 0.3s ease;
        }
        .pagination-btn:hover {
            transform: translateY(-2px);
        }
        .pagination-active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white py-16">
        <div class="container mx-auto px-6 text-center">
            <h1 class="text-5xl font-bold mb-4">üé® Portfolio Karya AI Siswa</h1>
            <p class="text-xl opacity-90 mb-8">Kumpulan karya kreatif siswa menggunakan teknologi AI</p>
            <div class="flex flex-wrap gap-4 justify-center">
                <button onclick="openModal()" class="bg-white text-purple-600 px-8 py-3 rounded-full font-semibold hover:bg-gray-100 transition-colors">
                    ‚ûï Tambah Karya Baru
                </button>
                <button onclick="loadFromGoogleSheets()" class="bg-purple-700 text-white px-8 py-3 rounded-full font-semibold hover:bg-purple-800 transition-colors">
                    üîÑ Refresh Data
                </button>
                <button onclick="showSetupInstructions()" class="bg-yellow-500 text-white px-8 py-3 rounded-full font-semibold hover:bg-yellow-600 transition-colors">
                    ‚öôÔ∏è Setup Apps Script
                </button>
            </div>
        </div>
    </header>

    <!-- Stats Section -->
    <section class="py-12 bg-white">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                <div class="p-6">
                    <div class="text-4xl font-bold text-purple-600" id="totalWorks">0</div>
                    <div class="text-gray-600 mt-2">Total Karya</div>
                </div>
                <div class="p-6">
                    <div class="text-4xl font-bold text-blue-600" id="totalStudents">0</div>
                    <div class="text-gray-600 mt-2">Siswa Berpartisipasi</div>
                </div>
                <div class="p-6">
                    <div class="text-4xl font-bold text-green-600" id="totalCategories">0</div>
                    <div class="text-gray-600 mt-2">Kategori Karya</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Filter Section -->
    <section class="py-8 bg-gray-100">
        <div class="container mx-auto px-6">
            <div class="flex flex-wrap justify-center gap-4">
                <button onclick="filterWorks('all')" class="filter-btn active bg-purple-600 text-white px-6 py-2 rounded-full hover:bg-purple-700 transition-colors">
                    Semua Karya
                </button>
                <button onclick="filterWorks('gambar')" class="filter-btn bg-gradient-to-r from-red-400 to-orange-400 text-white px-6 py-2 rounded-full hover:from-red-500 hover:to-orange-500 transition-all">
                    üé® Gambar AI
                </button>
                <button onclick="filterWorks('teks')" class="filter-btn bg-gradient-to-r from-teal-400 to-green-400 text-white px-6 py-2 rounded-full hover:from-teal-500 hover:to-green-500 transition-all">
                    üìù Teks AI
                </button>
                <button onclick="filterWorks('video')" class="filter-btn bg-gradient-to-r from-blue-400 to-purple-400 text-white px-6 py-2 rounded-full hover:from-blue-500 hover:to-purple-500 transition-all">
                    üé¨ Video AI
                </button>
                <button onclick="filterWorks('musik')" class="filter-btn bg-gradient-to-r from-indigo-400 to-purple-400 text-white px-6 py-2 rounded-full hover:from-indigo-500 hover:to-purple-500 transition-all">
                    üéµ Musik AI
                </button>
            </div>
        </div>
    </section>

    <!-- Gallery Section -->
    <section class="py-16">
        <div class="container mx-auto px-6">
            <div id="gallery" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12">
                <!-- Karya akan ditampilkan di sini -->
            </div>
            
            <!-- Pagination -->
            <div id="pagination" class="flex justify-center items-center gap-2 hidden">
                <button onclick="changePage('prev')" id="prevBtn" class="pagination-btn bg-white text-gray-600 px-4 py-2 rounded-lg border hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                    ‚Üê Sebelumnya
                </button>
                <div id="pageNumbers" class="flex gap-2">
                    <!-- Page numbers will be inserted here -->
                </div>
                <button onclick="changePage('next')" id="nextBtn" class="pagination-btn bg-white text-gray-600 px-4 py-2 rounded-lg border hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                    Selanjutnya ‚Üí
                </button>
            </div>
            
            <div id="emptyState" class="text-center py-16 hidden">
                <div class="text-6xl mb-4">üé®</div>
                <h3 class="text-2xl font-semibold text-gray-700 mb-2">Belum Ada Karya</h3>
                <p class="text-gray-500 mb-6">Jadilah yang pertama menambahkan karya AI!</p>
                <button onclick="openModal()" class="bg-purple-600 text-white px-6 py-3 rounded-full hover:bg-purple-700 transition-colors">
                    Tambah Karya Pertama
                </button>
            </div>
        </div>
    </section>

    <!-- Modal Form -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">Tambah Karya Baru</h2>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                </div>
                
                <form id="workForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Siswa *</label>
                        <input type="text" id="studentName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Masukkan nama siswa">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kelas *</label>
                        <select id="studentClass" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">Pilih Kelas</option>
                            <option value="X">Kelas X</option>
                            <option value="XI">Kelas XI</option>
                            <option value="XII">Kelas XII</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Judul Karya *</label>
                        <input type="text" id="workTitle" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Masukkan judul karya">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kategori Karya *</label>
                        <select id="workCategory" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            <option value="">Pilih Kategori</option>
                            <option value="gambar">üé® Gambar AI</option>
                            <option value="teks">üìù Teks AI</option>
                            <option value="video">üé¨ Video AI</option>
                            <option value="musik">üéµ Musik AI</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi Karya *</label>
                        <textarea id="workDescription" required rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Ceritakan tentang karya Anda..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tool AI yang Digunakan *</label>
                        <input type="text" id="aiTool" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Contoh: ChatGPT, DALL-E, Midjourney">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Link Karya (Opsional)</label>
                        <input type="url" id="workLink" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="https://...">
                    </div>
                    
                    <div class="pt-4">
                        <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                            üíæ Simpan Karya
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Setup Instructions Modal -->
    <div id="setupModal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">üöÄ Setup Google Apps Script</h2>
                    <button onclick="closeSetupModal()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                </div>
                
                <div class="space-y-6">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="font-bold text-blue-800 mb-2">üìã Langkah 1: Buat Google Apps Script</h3>
                        <ol class="list-decimal list-inside space-y-2 text-sm text-blue-700">
                            <li>Buka <a href="https://script.google.com" target="_blank" class="underline">script.google.com</a></li>
                            <li>Klik "New Project"</li>
                            <li>Ganti nama project menjadi "AI Portfolio API"</li>
                        </ol>
                    </div>

                    <div class="bg-green-50 p-4 rounded-lg">
                        <h3 class="font-bold text-green-800 mb-2">üíª Langkah 2: Copy Kode Apps Script (FINAL FIX - JSON Response)</h3>
                        <div class="bg-gray-800 text-green-400 p-4 rounded text-sm font-mono overflow-x-auto">
<pre>// COMPATIBILITY FIX - Works with all Google Apps Script versions
function doPost(e) {
  try {
    console.log('POST Request received:', e);
    
    // Open spreadsheet
    const sheet = SpreadsheetApp.openById('17MDc804lNUm_XwUM6hPj6Ui8T-JVtpxJCLq4XovVs0A')
                                .getSheetByName('Sheet2');
    
    // Parse request data with multiple fallbacks
    let data = {};
    
    if (e.postData && e.postData.contents) {
      try {
        data = JSON.parse(e.postData.contents);
      } catch (parseError) {
        console.log('JSON parse failed, trying form data');
        data = e.parameter || {};
      }
    } else if (e.parameter) {
      data = e.parameter;
    } else {
      console.log('No data received');
      return createJsonResponse({
        success: false,
        error: 'No data received'
      });
    }
    
    console.log('Parsed data:', data);
    
    // Validate required fields
    if (!data.studentName || !data.title) {
      return createJsonResponse({
        success: false,
        error: 'Nama siswa dan judul karya wajib diisi',
        receivedData: data
      });
    }
    
    // Add row to sheet
    const newRow = [
      data.studentName || '',
      data.studentClass || '',
      data.title || '',
      data.category || '',
      data.description || '',
      data.aiTool || '',
      data.link || '',
      new Date().toLocaleDateString('id-ID')
    ];
    
    console.log('Adding row:', newRow);
    sheet.appendRow(newRow);
    
    return createJsonResponse({
      success: true,
      message: 'Data berhasil disimpan ke Google Sheets!',
      timestamp: new Date().toISOString(),
      rowData: newRow
    });
    
  } catch (error) {
    console.error('doPost Error:', error);
    return createJsonResponse({
      success: false,
      error: 'Server error: ' + error.toString(),
      timestamp: new Date().toISOString()
    });
  }
}

function doGet(e) {
  try {
    console.log('GET Request received:', e);
    
    return createJsonResponse({
      success: true,
      status: 'AI Portfolio API is ACTIVE and WORKING',
      message: 'Connection test successful! ‚úÖ',
      timestamp: new Date().toISOString(),
      method: 'GET',
      serverTime: new Date().toString(),
      sheetId: '17MDc804lNUm_XwUM6hPj6Ui8T-JVtpxJCLq4XovVs0A'
    });
    
  } catch (error) {
    console.error('doGet Error:', error);
    return createJsonResponse({
      success: false,
      error: 'GET error: ' + error.toString(),
      timestamp: new Date().toISOString()
    });
  }
}

function createJsonResponse(data) {
  const jsonString = JSON.stringify(data, null, 2);
  console.log('Returning JSON:', jsonString);
  
  // Create response with proper MIME type
  const output = ContentService.createTextOutput(jsonString);
  output.setMimeType(ContentService.MimeType.JSON);
  
  // Add CORS headers if setHeader method is available
  try {
    if (typeof output.setHeader === 'function') {
      output.setHeader('Access-Control-Allow-Origin', '*');
      output.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
      output.setHeader('Access-Control-Allow-Headers', 'Content-Type');
    }
  } catch (headerError) {
    console.log('Headers not supported in this environment');
  }
  
  return output;
}</pre>
                        </div>
                        <button onclick="copyCode()" class="mt-2 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors text-sm">
                            üìã Copy Kode
                        </button>
                    </div>

                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <h3 class="font-bold text-yellow-800 mb-2">üöÄ Langkah 3: Deploy Web App</h3>
                        <ol class="list-decimal list-inside space-y-2 text-sm text-yellow-700">
                            <li>Klik tombol "Deploy" di pojok kanan atas</li>
                            <li>Pilih "New deployment"</li>
                            <li>Klik ikon gear ‚öôÔ∏è dan pilih "Web app"</li>
                            <li>Atur pengaturan:
                                <ul class="list-disc list-inside ml-4 mt-1">
                                    <li>Execute as: <strong>Me</strong></li>
                                    <li>Who has access: <strong>Anyone</strong></li>
                                </ul>
                            </li>
                            <li>Klik "Deploy"</li>
                            <li>Copy URL yang diberikan</li>
                        </ol>
                    </div>

                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h3 class="font-bold text-purple-800 mb-2">üîó Langkah 4: Update Website</h3>
                        <p class="text-sm text-purple-700 mb-3">Paste URL Apps Script Anda di bawah ini:</p>
                        <div class="flex gap-2 mb-3">
                            <input type="url" id="appsScriptUrl" value="https://script.google.com/macros/s/AKfycbx2AxnDGOrQXWFV3yWj5dA4wbkbPXkGmoHFMYtwcVYfRmNwMQK_XtVEk2_mpZR1XUkz/exec" placeholder="https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec" class="flex-1 px-3 py-2 border border-purple-300 rounded-lg text-sm">
                            <button onclick="updateAppsScriptUrl()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors text-sm">
                                üíæ Update
                            </button>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="testConnection()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm flex-1">
                                üîç Test Koneksi
                            </button>
                            <button onclick="openAppsScriptUrl()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm flex-1">
                                üåê Buka URL
                            </button>
                        </div>
                        <div id="testResult" class="mt-3 p-3 rounded-lg hidden"></div>
                    </div>

                    <div class="bg-red-50 p-4 rounded-lg">
                        <h3 class="font-bold text-red-800 mb-2">üîß Troubleshooting "Failed to fetch"</h3>
                        <div class="text-sm text-red-700 space-y-2">
                            <p><strong>Jika masih error "Failed to fetch":</strong></p>
                            <ol class="list-decimal list-inside space-y-1 ml-2">
                                <li>Pastikan Apps Script sudah di-<strong>DEPLOY ULANG</strong> dengan kode terbaru</li>
                                <li>Cek permission: Execute as <strong>"Me"</strong>, Access <strong>"Anyone"</strong></li>
                                <li>Tunggu 2-3 menit setelah deploy untuk propagasi</li>
                                <li>Coba buka URL di browser baru (incognito mode)</li>
                                <li>Pastikan tidak ada typo di URL Apps Script</li>
                            </ol>
                            <p class="mt-2 font-semibold">‚ö†Ô∏è PENTING: Setiap kali update kode, harus DEPLOY ULANG!</p>
                        </div>
                    </div>

                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-gray-800 mb-2">‚úÖ Langkah 5: Test</h3>
                        <p class="text-sm text-gray-700">Setelah setup selesai, coba tambah karya baru untuk memastikan data tersimpan ke Google Sheets!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="container mx-auto px-6 text-center">
            <h3 class="text-2xl font-bold mb-4">Portfolio Karya AI Siswa</h3>
            <p class="text-gray-400 mb-4">Menginspirasi kreativitas melalui teknologi AI</p>
            <div class="text-sm text-gray-500 max-w-2xl mx-auto">
                <p class="mb-2"><strong>üîó Google Sheets Integration:</strong></p>
                <p class="mb-1">‚Ä¢ Sheet ID: 17MDc804lNUm_XwUM6hPj6Ui8T-JVtpxJCLq4XovVs0A</p>
                <p class="mb-1">‚Ä¢ Sheet Name: Sheet2</p>
                <p class="mb-3" id="connectionStatus">‚Ä¢ Status: <span class="text-green-400">Connected ‚úÖ</span></p>
                
                <div class="bg-gray-700 p-4 rounded-lg text-left">
                    <p class="text-yellow-400 font-semibold mb-2">üìã Format Header Google Sheets:</p>
                    <p class="font-mono text-xs">Nama Siswa | Kelas | Judul Karya | Kategori | Deskripsi | Tool AI | Link | Tanggal</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Google Sheets Configuration
        const GOOGLE_SHEETS_CONFIG = {
            SHEET_ID: '17MDc804lNUm_XwUM6hPj6Ui8T-JVtpxJCLq4XovVs0A',
            SHEET_NAME: 'Sheet2',
            API_KEY: 'AIzaSyCAJWvsjw92iebZM54KZivepTpl_Q2gk70',
            // Pre-filled with your URL
            APPS_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbx2AxnDGOrQXWFV3yWj5dA4wbkbPXkGmoHFMYtwcVYfRmNwMQK_XtVEk2_mpZR1XUkz/exec'
        };

        // Database variables
        let worksDatabase = [];
        let currentFilter = 'all';
        let isLoading = false;
        
        // Pagination variables
        let currentPage = 1;
        const itemsPerPage = 6;
        let filteredWorks = [];

        // Google Apps Script Functions
        async function saveToGoogleSheets(workData) {
            if (!GOOGLE_SHEETS_CONFIG.APPS_SCRIPT_URL) {
                throw new Error('Google Apps Script URL belum dikonfigurasi');
            }

            try {
                console.log('Sending data to Apps Script:', workData);
                
                // Try multiple request methods for better compatibility
                let response;
                let lastError;
                
                // Method 1: JSON POST (preferred)
                try {
                    response = await fetch(GOOGLE_SHEETS_CONFIG.APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(workData)
                    });
                    
                    if (response.ok) {
                        console.log('JSON POST successful');
                    } else {
                        throw new Error(`JSON POST failed: ${response.status}`);
                    }
                } catch (jsonError) {
                    console.log('JSON POST failed, trying form data:', jsonError);
                    lastError = jsonError;
                    
                    // Method 2: Form data POST (fallback)
                    const formData = new FormData();
                    Object.keys(workData).forEach(key => {
                        formData.append(key, workData[key]);
                    });
                    
                    response = await fetch(GOOGLE_SHEETS_CONFIG.APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'cors',
                        body: formData
                    });
                    
                    if (response.ok) {
                        console.log('Form data POST successful');
                    } else {
                        throw new Error(`Form data POST failed: ${response.status}`);
                    }
                }

                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // Handle response
                const responseText = await response.text();
                console.log('Raw response:', responseText);
                
                // Try to parse as JSON
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('Failed to parse JSON response:', responseText);
                    
                    // Check if it's an HTML error page
                    if (responseText.includes('<html') || responseText.includes('<!DOCTYPE')) {
                        throw new Error('Apps Script mengembalikan HTML error page. Pastikan deployment sudah benar dan aktif!');
                    } else {
                        throw new Error('Response bukan JSON valid. Cek kode Apps Script dan deploy ulang.');
                    }
                }
                
                console.log('Parsed response:', result);
                
                if (!result.success) {
                    throw new Error(result.error || 'Gagal menyimpan data ke Google Sheets');
                }
                
                return result;
                
            } catch (error) {
                console.error('Error saving to Google Sheets:', error);
                
                // Provide specific error messages
                if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    throw new Error('Koneksi ke Apps Script gagal. Pastikan URL sudah benar dan internet stabil.');
                } else if (error.message.includes('HTML error page')) {
                    throw new Error('Apps Script error. Cek permission dan deploy ulang dengan kode terbaru.');
                } else if (error.message.includes('JSON')) {
                    throw new Error('Format response error. Pastikan menggunakan kode Apps Script yang terbaru.');
                } else {
                    throw new Error(`Error: ${error.message}`);
                }
            }
        }

        async function loadFromGoogleSheets() {
            if (isLoading) return;
            isLoading = true;
            showLoadingState();

            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${GOOGLE_SHEETS_CONFIG.SHEET_ID}/values/${GOOGLE_SHEETS_CONFIG.SHEET_NAME}?key=${GOOGLE_SHEETS_CONFIG.API_KEY}`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.values && data.values.length > 1) {
                    // Skip header row (index 0)
                    worksDatabase = data.values.slice(1).map((row, index) => ({
                        id: index + 1,
                        studentName: row[0] || '',
                        studentClass: row[1] || '',
                        title: row[2] || '',
                        category: row[3] || '',
                        description: row[4] || '',
                        aiTool: row[5] || '',
                        link: row[6] || '',
                        dateAdded: row[7] || new Date().toLocaleDateString('id-ID')
                    })).filter(work => work.studentName); // Filter out empty rows
                } else {
                    worksDatabase = [];
                }
                
                displayWorks();
                updateStats();
                showNotification('Data berhasil dimuat dari Google Sheets! üìä');
                
            } catch (error) {
                console.error('Error loading from Google Sheets:', error);
                showNotification('Gagal memuat data dari Google Sheets. Menggunakan data lokal. ‚ö†Ô∏è', 'error');
                // Fallback to local storage
                worksDatabase = JSON.parse(localStorage.getItem('aiWorksDB') || '[]');
                displayWorks();
                updateStats();
            } finally {
                isLoading = false;
                hideLoadingState();
            }
        }

        function showLoadingState() {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = `
                <div class="col-span-full text-center py-16">
                    <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"></div>
                    <p class="text-gray-600">Memuat data dari Google Sheets...</p>
                </div>
            `;
        }

        function hideLoadingState() {
            // Loading state will be replaced by displayWorks()
        }

        // Setup Functions
        function showSetupInstructions() {
            document.getElementById('setupModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeSetupModal() {
            document.getElementById('setupModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        function copyCode() {
            const code = `// COMPATIBILITY FIX - Works with all Google Apps Script versions
function doPost(e) {
  try {
    console.log('POST Request received:', e);
    
    // Open spreadsheet
    const sheet = SpreadsheetApp.openById('17MDc804lNUm_XwUM6hPj6Ui8T-JVtpxJCLq4XovVs0A')
                                .getSheetByName('Sheet2');
    
    // Parse request data with multiple fallbacks
    let data = {};
    
    if (e.postData && e.postData.contents) {
      try {
        data = JSON.parse(e.postData.contents);
      } catch (parseError) {
        console.log('JSON parse failed, trying form data');
        data = e.parameter || {};
      }
    } else if (e.parameter) {
      data = e.parameter;
    } else {
      console.log('No data received');
      return createJsonResponse({
        success: false,
        error: 'No data received'
      });
    }
    
    console.log('Parsed data:', data);
    
    // Validate required fields
    if (!data.studentName || !data.title) {
      return createJsonResponse({
        success: false,
        error: 'Nama siswa dan judul karya wajib diisi',
        receivedData: data
      });
    }
    
    // Add row to sheet
    const newRow = [
      data.studentName || '',
      data.studentClass || '',
      data.title || '',
      data.category || '',
      data.description || '',
      data.aiTool || '',
      data.link || '',
      new Date().toLocaleDateString('id-ID')
    ];
    
    console.log('Adding row:', newRow);
    sheet.appendRow(newRow);
    
    return createJsonResponse({
      success: true,
      message: 'Data berhasil disimpan ke Google Sheets!',
      timestamp: new Date().toISOString(),
      rowData: newRow
    });
    
  } catch (error) {
    console.error('doPost Error:', error);
    return createJsonResponse({
      success: false,
      error: 'Server error: ' + error.toString(),
      timestamp: new Date().toISOString()
    });
  }
}

function doGet(e) {
  try {
    console.log('GET Request received:', e);
    
    return createJsonResponse({
      success: true,
      status: 'AI Portfolio API is ACTIVE and WORKING',
      message: 'Connection test successful! ‚úÖ',
      timestamp: new Date().toISOString(),
      method: 'GET',
      serverTime: new Date().toString(),
      sheetId: '17MDc804lNUm_XwUM6hPj6Ui8T-JVtpxJCLq4XovVs0A'
    });
    
  } catch (error) {
    console.error('doGet Error:', error);
    return createJsonResponse({
      success: false,
      error: 'GET error: ' + error.toString(),
      timestamp: new Date().toISOString()
    });
  }
}

function createJsonResponse(data) {
  const jsonString = JSON.stringify(data, null, 2);
  console.log('Returning JSON:', jsonString);
  
  // Create response with proper MIME type
  const output = ContentService.createTextOutput(jsonString);
  output.setMimeType(ContentService.MimeType.JSON);
  
  // Add CORS headers if setHeader method is available
  try {
    if (typeof output.setHeader === 'function') {
      output.setHeader('Access-Control-Allow-Origin', '*');
      output.setHeader('Access-Control-Allow-Methods', 'GET, POST, OPTIONS');
      output.setHeader('Access-Control-Allow-Headers', 'Content-Type');
    }
  } catch (headerError) {
    console.log('Headers not supported in this environment');
  }
  
  return output;
}`;

            navigator.clipboard.writeText(code).then(() => {
                showNotification('Kode Apps Script terbaru berhasil dicopy! üìã');
            }).catch(() => {
                showNotification('Gagal copy kode. Silakan copy manual. ‚ùå', 'error');
            });
        }

        function updateAppsScriptUrl() {
            const url = document.getElementById('appsScriptUrl').value.trim();
            if (!url) {
                showNotification('Silakan masukkan URL Apps Script! ‚ö†Ô∏è', 'warning');
                return;
            }

            if (!url.includes('script.google.com/macros/s/')) {
                showNotification('URL tidak valid! Pastikan menggunakan URL deployment Apps Script. ‚ùå', 'error');
                return;
            }

            GOOGLE_SHEETS_CONFIG.APPS_SCRIPT_URL = url;
            localStorage.setItem('appsScriptUrl', url);
            
            // Update status
            document.getElementById('connectionStatus').innerHTML = '‚Ä¢ Status: <span class="text-green-400">Connected ‚úÖ</span>';
            
            showNotification('Apps Script URL berhasil diupdate! Sekarang Anda bisa menyimpan data ke Google Sheets. üéâ');
            closeSetupModal();
        }

        async function testConnection() {
            const url = document.getElementById('appsScriptUrl').value.trim();
            const testResult = document.getElementById('testResult');
            
            if (!url) {
                showTestResult('‚ùå Silakan masukkan URL terlebih dahulu!', 'error');
                return;
            }

            showTestResult('üîÑ Testing koneksi...', 'info');

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors'
                });

                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    if (contentType && contentType.includes('application/json')) {
                        const result = await response.json();
                        showTestResult(`‚úÖ Koneksi berhasil! Status: ${result.status || 'OK'}`, 'success');
                    } else {
                        showTestResult('‚ö†Ô∏è Koneksi berhasil tapi response bukan JSON. Pastikan kode Apps Script sudah diupdate!', 'error');
                    }
                } else {
                    showTestResult(`‚ùå HTTP Error: ${response.status} - ${response.statusText}`, 'error');
                }
            } catch (error) {
                console.error('Test connection error:', error);
                showTestResult(`‚ùå Koneksi gagal: ${error.message}`, 'error');
            }
        }

        function openAppsScriptUrl() {
            const url = document.getElementById('appsScriptUrl').value.trim();
            if (!url) {
                showNotification('Silakan masukkan URL terlebih dahulu! ‚ö†Ô∏è', 'warning');
                return;
            }
            window.open(url, '_blank');
        }

        function showTestResult(message, type) {
            const testResult = document.getElementById('testResult');
            const colors = {
                success: 'bg-green-100 text-green-800 border-green-300',
                error: 'bg-red-100 text-red-800 border-red-300',
                info: 'bg-blue-100 text-blue-800 border-blue-300'
            };
            
            testResult.className = `mt-3 p-3 rounded-lg border ${colors[type]}`;
            testResult.textContent = message;
            testResult.classList.remove('hidden');
        }

        // Pagination Functions
        function updatePagination() {
            const totalPages = Math.ceil(filteredWorks.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            const pageNumbers = document.getElementById('pageNumbers');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            if (totalPages <= 1) {
                pagination.classList.add('hidden');
                return;
            }

            pagination.classList.remove('hidden');

            // Update prev/next buttons
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;

            // Generate page numbers
            pageNumbers.innerHTML = '';
            for (let i = 1; i <= totalPages; i++) {
                const pageBtn = document.createElement('button');
                pageBtn.textContent = i;
                pageBtn.className = `pagination-btn px-3 py-2 rounded-lg border ${
                    i === currentPage 
                        ? 'pagination-active' 
                        : 'bg-white text-gray-600 hover:bg-gray-50'
                }`;
                pageBtn.onclick = () => goToPage(i);
                pageNumbers.appendChild(pageBtn);
            }
        }

        function goToPage(page) {
            currentPage = page;
            displayWorks();
        }

        function changePage(direction) {
            if (direction === 'prev' && currentPage > 1) {
                currentPage--;
            } else if (direction === 'next') {
                const totalPages = Math.ceil(filteredWorks.length / itemsPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                }
            }
            displayWorks();
        }

        // Inisialisasi website
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-load data on startup
            loadFromGoogleSheets();
        });

        // Fungsi untuk membuka modal
        function openModal() {
            document.getElementById('modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Fungsi untuk menutup modal
        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            document.getElementById('workForm').reset();
        }

        // Handle form submission
        document.getElementById('workForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = e.target.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '‚è≥ Menyimpan...';
            submitButton.disabled = true;
            
            const newWork = {
                studentName: document.getElementById('studentName').value,
                studentClass: document.getElementById('studentClass').value,
                title: document.getElementById('workTitle').value,
                category: document.getElementById('workCategory').value,
                description: document.getElementById('workDescription').value,
                aiTool: document.getElementById('aiTool').value,
                link: document.getElementById('workLink').value,
                dateAdded: new Date().toLocaleDateString('id-ID')
            };

            try {
                if (GOOGLE_SHEETS_CONFIG.APPS_SCRIPT_URL) {
                    // Save to Google Sheets via Apps Script
                    await saveToGoogleSheets(newWork);
                    showNotification('Karya berhasil disimpan ke Google Sheets! üéâ');
                } else {
                    // Fallback to local storage
                    const localData = JSON.parse(localStorage.getItem('aiWorksDB') || '[]');
                    localData.push({...newWork, id: Date.now()});
                    localStorage.setItem('aiWorksDB', JSON.stringify(localData));
                    showNotification('Karya disimpan lokal. Setup Apps Script untuk sinkronisasi penuh! üíæ', 'warning');
                }
                
                // Reload data and update display
                await loadFromGoogleSheets();
                closeModal();
                
            } catch (error) {
                console.error('Error submitting form:', error);
                showNotification(`Gagal menyimpan: ${error.message} ‚ùå`, 'error');
            } finally {
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        });

        // Fungsi untuk menampilkan karya dengan pagination
        function displayWorks() {
            const gallery = document.getElementById('gallery');
            const emptyState = document.getElementById('emptyState');
            
            // Filter works based on current filter
            if (currentFilter === 'all') {
                filteredWorks = [...worksDatabase];
            } else {
                filteredWorks = worksDatabase.filter(work => work.category === currentFilter);
            }

            if (filteredWorks.length === 0) {
                gallery.innerHTML = '';
                emptyState.classList.remove('hidden');
                document.getElementById('pagination').classList.add('hidden');
                return;
            }

            emptyState.classList.add('hidden');
            
            // Calculate pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const worksToShow = filteredWorks.slice(startIndex, endIndex);
            
            gallery.innerHTML = worksToShow.map(work => `
                <div class="rounded-2xl shadow-lg card-hover overflow-hidden card-${work.category} transform transition-all duration-300">
                    <div class="p-6 card-content-${work.category} rounded-2xl m-1">
                        <div class="flex items-center justify-between mb-4">
                            <span class="px-4 py-2 category-${work.category} rounded-full text-sm font-semibold shadow-lg transform hover:scale-105 transition-transform">
                                ${getCategoryIcon(work.category)} ${getCategoryName(work.category)}
                            </span>
                            <span class="text-sm text-gray-600 bg-white bg-opacity-70 px-3 py-1 rounded-full shadow-sm">${work.dateAdded}</span>
                        </div>
                        
                        <h3 class="text-xl font-bold text-gray-800 mb-3 leading-tight">${work.title}</h3>
                        <p class="text-gray-700 mb-4 line-clamp-3 leading-relaxed">${work.description}</p>
                        
                        <div class="space-y-3 mb-6">
                            <div class="flex items-center text-sm">
                                <div class="w-10 h-10 ${getAvatarGradient(work.category)} rounded-full flex items-center justify-center text-white font-bold text-sm mr-3 shadow-lg">
                                    ${work.studentName.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <div class="font-semibold text-gray-800">${work.studentName}</div>
                                    <div class="text-gray-600 text-xs">Kelas ${work.studentClass}</div>
                                </div>
                            </div>
                            <div class="flex items-center text-sm text-gray-700 bg-white bg-opacity-60 p-3 rounded-xl shadow-sm">
                                <span class="text-lg mr-3">ü§ñ</span>
                                <span class="font-semibold">${work.aiTool}</span>
                            </div>
                        </div>
                        
                        <div class="flex gap-2">
                            ${work.link ? `
                                <a href="${work.link}" target="_blank" class="flex-1 ${getButtonGradient(work.category)} text-white text-center py-3 rounded-xl hover:shadow-xl transition-all text-sm font-semibold shadow-lg transform hover:scale-105 hover:-translate-y-1">
                                    üîó Lihat Karya
                                </a>
                            ` : `
                                <div class="flex-1 bg-gray-200 text-gray-500 text-center py-3 rounded-xl text-sm font-medium">
                                    üìÑ Tidak ada link
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `).join('');
            
            updatePagination();
        }

        // Fungsi untuk filter karya
        function filterWorks(category) {
            currentFilter = category;
            currentPage = 1; // Reset to first page when filtering
            
            // Update button states
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (category === 'all') {
                    btn.classList.remove('bg-gradient-to-r', 'from-red-400', 'to-orange-400', 'from-teal-400', 'to-green-400', 'from-blue-400', 'to-purple-400', 'from-indigo-400');
                    btn.classList.add('bg-white', 'text-gray-700');
                }
            });
            
            if (category === 'all') {
                event.target.classList.add('active', 'bg-purple-600', 'text-white');
                event.target.classList.remove('bg-white', 'text-gray-700');
            } else {
                event.target.classList.add('active');
            }
            
            displayWorks();
        }

        // Fungsi untuk update statistik
        function updateStats() {
            const totalWorks = worksDatabase.length;
            const uniqueStudents = new Set(worksDatabase.map(work => work.studentName)).size;
            const uniqueCategories = new Set(worksDatabase.map(work => work.category)).size;
            
            document.getElementById('totalWorks').textContent = totalWorks;
            document.getElementById('totalStudents').textContent = uniqueStudents;
            document.getElementById('totalCategories').textContent = uniqueCategories;
        }

        // Helper functions
        function getCategoryIcon(category) {
            const icons = {
                'gambar': 'üé®',
                'teks': 'üìù',
                'video': 'üé¨',
                'musik': 'üéµ'
            };
            return icons[category] || 'üé®';
        }

        function getCategoryName(category) {
            const names = {
                'gambar': 'Gambar AI',
                'teks': 'Teks AI',
                'video': 'Video AI',
                'musik': 'Musik AI'
            };
            return names[category] || 'Karya AI';
        }

        function getAvatarGradient(category) {
            const gradients = {
                'gambar': 'bg-gradient-to-br from-red-400 to-pink-500',
                'teks': 'bg-gradient-to-br from-teal-400 to-cyan-500',
                'video': 'bg-gradient-to-br from-blue-500 to-purple-600',
                'musik': 'bg-gradient-to-br from-orange-400 to-red-500'
            };
            return gradients[category] || 'bg-gradient-to-br from-purple-400 to-pink-500';
        }

        function getButtonGradient(category) {
            const gradients = {
                'gambar': 'bg-gradient-to-r from-red-500 to-pink-600 hover:from-red-600 hover:to-pink-700',
                'teks': 'bg-gradient-to-r from-teal-500 to-cyan-600 hover:from-teal-600 hover:to-cyan-700',
                'video': 'bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700',
                'musik': 'bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700'
            };
            return gradients[category] || 'bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700';
        }

        // Fungsi notifikasi
        function showNotification(message, type = 'success') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-transform max-w-sm`;
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">√ó</button>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }
            }, type === 'warning' ? 5000 : 3000);
        }

        // Close modal when clicking outside
        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        document.getElementById('setupModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSetupModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976214ab4037f8e2',t:'MTc1NjM2NTk4OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
