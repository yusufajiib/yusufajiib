<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Madrasah Al-Hikmah - Website Resmi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #166534 0%, #16a34a 50%, #22c55e 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center">
                        <span class="text-2xl">🕌</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Madrasah Hasyim Asy'ari 1 Kudus</h1>
                        <p class="text-green-100 text-sm">Mencerdaskan Generasi Islami</p>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <a href="#" onclick="showHome()" class="hover:text-green-200 transition-colors font-medium">Beranda</a>
                    <a href="#" onclick="showAbout()" class="hover:text-green-200 transition-colors font-medium">Tentang</a>
                    <a href="#" onclick="showContact()" class="hover:text-green-200 transition-colors font-medium">Kontak</a>
                    <a href="#" onclick="showAdminPanel()" class="hover:text-green-200 transition-colors font-medium">⚙️ Admin</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="gradient-bg text-white py-16">
        <div class="container mx-auto px-6 text-center">
            <h2 class="text-4xl md:text-5xl font-bold mb-6">Selamat Datang di Madrasah Hasyim Asy'ari 1 Kudus</h2>
            <p class="text-xl text-green-100 mb-8 max-w-3xl mx-auto">Lembaga pendidikan Islam yang mengintegrasikan ilmu agama dan umum untuk membentuk generasi yang berakhlak mulia dan berprestasi</p>
            <button class="bg-white text-green-600 px-8 py-3 rounded-lg font-semibold hover:bg-green-50 transition-colors">Pelajari Lebih Lanjut</button>
        </div>
    </section>

    <!-- Search Section -->
    <section class="py-8 bg-gray-100">
        <div class="container mx-auto px-6">
            <div class="max-w-2xl mx-auto">
                <div class="relative">
                    <input type="text" id="searchInput" placeholder="Cari informasi, kategori, atau konten..." 
                           class="w-full px-6 py-4 pr-12 text-lg border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent">
                    <button onclick="performSearch()" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-green-600 hover:text-green-700">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                        </svg>
                    </button>
                </div>
                <div id="searchResults" class="mt-4 hidden">
                    <div class="bg-white rounded-lg shadow-md p-4">
                        <h4 class="font-semibold text-gray-800 mb-3">Hasil Pencarian:</h4>
                        <div id="searchResultsList"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Categories -->
    <section class="py-16" id="categoriesSection">
        <div class="container mx-auto px-6">
            <h3 class="text-3xl font-bold text-center text-gray-800 mb-12">Kategori Utama</h3>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="categoriesGrid">
                <!-- Categories will be populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Content Area -->
    <section class="py-16 bg-white" id="contentSection" style="display: none;">
        <div class="container mx-auto px-6">
            <div class="flex items-center mb-8">
                <button id="backButton" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors mr-4">← Kembali</button>
                <h3 id="contentTitle" class="text-3xl font-bold text-gray-800"></h3>
            </div>
            <div id="contentArea" class="grid gap-6">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="py-16 bg-white" id="aboutSection" style="display: none;">
        <div class="container mx-auto px-6">
            <div class="flex items-center mb-8">
                <button onclick="showHome()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors mr-4">← Kembali</button>
                <h3 class="text-3xl font-bold text-gray-800">Tentang Madrasah</h3>
            </div>
            <div class="grid md:grid-cols-2 gap-12">
                <div>
                    <h4 class="text-2xl font-semibold text-gray-800 mb-4">Sejarah Singkat</h4>
                    <p class="text-gray-600 mb-6">Madrasah Hasyim Asy'ari 1 Kudus didirikan pada tahun 1985 dengan visi menjadi lembaga pendidikan Islam terdepan di Kudus. Nama madrasah diambil dari tokoh ulama besar KH. Hasyim Asy'ari, pendiri Nahdlatul Ulama.</p>
                    
                    <h4 class="text-2xl font-semibold text-gray-800 mb-4">Visi</h4>
                    <p class="text-gray-600 mb-6">Menjadi madrasah unggul yang menghasilkan generasi muslim yang berakhlak mulia, berprestasi, dan siap menghadapi tantangan zaman.</p>
                    
                    <h4 class="text-2xl font-semibold text-gray-800 mb-4">Misi</h4>
                    <ul class="text-gray-600 space-y-2">
                        <li>• Menyelenggarakan pendidikan Islam yang berkualitas</li>
                        <li>• Mengintegrasikan ilmu agama dan umum</li>
                        <li>• Membentuk karakter siswa yang berakhlak mulia</li>
                        <li>• Mengembangkan potensi siswa secara optimal</li>
                    </ul>
                </div>
                <div>
                    <div class="bg-green-50 p-6 rounded-lg">
                        <h4 class="text-2xl font-semibold text-gray-800 mb-4">Data Madrasah</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Tahun Berdiri:</span>
                                <span class="font-semibold">1985</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Jumlah Siswa:</span>
                                <span class="font-semibold">850 siswa</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Jumlah Guru:</span>
                                <span class="font-semibold">45 guru</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Akreditasi:</span>
                                <span class="font-semibold">A</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Luas Tanah:</span>
                                <span class="font-semibold">2.5 Ha</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="py-16 bg-white" id="contactSection" style="display: none;">
        <div class="container mx-auto px-6">
            <div class="flex items-center mb-8">
                <button onclick="showHome()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors mr-4">← Kembali</button>
                <h3 class="text-3xl font-bold text-gray-800">Kontak Kami</h3>
            </div>
            <div class="grid md:grid-cols-2 gap-12">
                <div>
                    <h4 class="text-2xl font-semibold text-gray-800 mb-6">Informasi Kontak</h4>
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <span class="text-2xl">📍</span>
                            <div>
                                <h5 class="font-semibold text-gray-800">Alamat</h5>
                                <p class="text-gray-600">Jl. KH. Hasyim Asy'ari No. 15, Kudus, Jawa Tengah 59311</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="text-2xl">📞</span>
                            <div>
                                <h5 class="font-semibold text-gray-800">Telepon</h5>
                                <p class="text-gray-600">(0291) 438-567</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="text-2xl">✉️</span>
                            <div>
                                <h5 class="font-semibold text-gray-800">Email</h5>
                                <p class="text-gray-600">info@mhasyim1kudus.sch.id</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="text-2xl">🌐</span>
                            <div>
                                <h5 class="font-semibold text-gray-800">Website</h5>
                                <p class="text-gray-600">www.mhasyim1kudus.sch.id</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 class="text-2xl font-semibold text-gray-800 mb-6">Kirim Pesan</h4>
                    <form class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Nama Lengkap</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Email</label>
                            <input type="email" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Subjek</label>
                            <input type="text" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">Pesan</label>
                            <textarea rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"></textarea>
                        </div>
                        <button type="button" onclick="alert('Demo: Pesan akan dikirim ke admin madrasah')" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                            Kirim Pesan
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Admin Panel -->
    <section class="py-16 bg-gray-100" id="adminPanel" style="display: none;">
        <div class="container mx-auto px-6">
            <div class="flex items-center justify-between mb-8">
                <h3 class="text-3xl font-bold text-gray-800">Panel Admin - Database Spreadsheet</h3>
                <button onclick="hideAdminPanel()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">✕ Tutup</button>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="text-xl font-semibold text-gray-800 mb-4">📊 Konfigurasi Database</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-gray-700 font-medium mb-2">URL Google Sheets:</label>
                            <input type="text" id="spreadsheetUrlInput" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 text-sm" placeholder="https://docs.google.com/spreadsheets/d/1234567890/pub?output=csv" value="">
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="updateSpreadsheetUrl()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                💾 Simpan URL
                            </button>
                            <button onclick="testSpreadsheetUrl()" class="bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors">
                                🧪 Test URL
                            </button>
                            <button onclick="refreshData()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                🔄 Refresh Data
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="text-xl font-semibold text-gray-800 mb-4">📋 Format Spreadsheet Sederhana</h4>
                    <div class="space-y-4 text-sm">
                        <p class="text-gray-600">Cukup buat 1 sheet dengan kolom berikut:</p>
                        <div class="bg-gray-50 p-4 rounded border">
                            <table class="w-full text-xs">
                                <thead>
                                    <tr class="border-b">
                                        <th class="text-left p-1">Kategori</th>
                                        <th class="text-left p-1">Judul Item</th>
                                        <th class="text-left p-1">Deskripsi</th>
                                        <th class="text-left p-1">Icon</th>
                                        <th class="text-left p-1">Warna</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="p-1">Kurikulum</td>
                                        <td class="p-1">Kurikulum Merdeka</td>
                                        <td class="p-1">Implementasi kurikulum terbaru</td>
                                        <td class="p-1">🎯</td>
                                        <td class="p-1">hijau</td>
                                    </tr>
                                    <tr>
                                        <td class="p-1">Kurikulum</td>
                                        <td class="p-1">Mata Pelajaran Agama</td>
                                        <td class="p-1">Al-Quran Hadits dan Akidah</td>
                                        <td class="p-1">☪️</td>
                                        <td class="p-1">hijau</td>
                                    </tr>
                                    <tr>
                                        <td class="p-1">Kesiswaan</td>
                                        <td class="p-1">Pendaftaran Siswa Baru</td>
                                        <td class="p-1">Info penerimaan siswa baru</td>
                                        <td class="p-1">📝</td>
                                        <td class="p-1">biru</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="text-xs text-gray-500">
                            <strong>Warna yang tersedia:</strong> hijau, biru, ungu, orange, merah, teal
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
                <h4 class="text-xl font-semibold text-gray-800 mb-4">📝 Setup Spreadsheet Baru (Anti Error!)</h4>
                <div class="space-y-4 text-sm">
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <h5 class="font-semibold text-green-800 mb-2">🎯 Struktur Baru - Super Sederhana!</h5>
                        <p class="text-green-700 mb-3">Hanya butuh <strong>3 kolom</strong> saja! Tidak perlu ribet dengan icon dan warna.</p>
                        
                        <div class="bg-white p-3 rounded border mb-3">
                            <table class="w-full text-xs">
                                <thead>
                                    <tr class="border-b bg-gray-50">
                                        <th class="text-left p-2 font-semibold">A: Kategori</th>
                                        <th class="text-left p-2 font-semibold">B: Judul</th>
                                        <th class="text-left p-2 font-semibold">C: Deskripsi</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-b">
                                        <td class="p-2">Kurikulum</td>
                                        <td class="p-2">Kurikulum Merdeka</td>
                                        <td class="p-2">Implementasi kurikulum terbaru</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="p-2">Kurikulum</td>
                                        <td class="p-2">Mata Pelajaran Agama</td>
                                        <td class="p-2">Al-Quran, Hadits, dan Akidah</td>
                                    </tr>
                                    <tr>
                                        <td class="p-2">Fasilitas</td>
                                        <td class="p-2">Ruang Kelas</td>
                                        <td class="p-2">32 ruang kelas ber-AC</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="bg-blue-100 p-3 rounded">
                            <p class="text-blue-800 text-sm"><strong>✨ Keunggulan:</strong></p>
                            <ul class="text-blue-700 text-sm mt-1 space-y-1">
                                <li>• Icon dan warna otomatis berdasarkan kategori</li>
                                <li>• Tidak ada masalah format CSV</li>
                                <li>• Lebih mudah dikelola</li>
                                <li>• Kompatibel dengan semua versi Google Sheets</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h5 class="font-semibold text-blue-800 mb-2">🚀 Langkah Setup (2 menit!):</h5>
                        <ol class="list-decimal list-inside space-y-2 text-blue-700">
                            <li><strong>Buka Google Sheets</strong> → Buat spreadsheet baru</li>
                            <li><strong>Copy data</strong> dari kotak hijau di bawah</li>
                            <li><strong>Paste di cell A1</strong> → Data otomatis tersusun dalam kolom</li>
                            <li><strong>File → Share → Publish to web</strong></li>
                            <li><strong>Pilih "Entire Document" + "CSV"</strong> → Publish</li>
                            <li><strong>Copy URL</strong> → Paste di field URL di atas</li>
                            <li><strong>Klik "Simpan URL"</strong> → "Refresh Data"</li>
                        </ol>
                    </div>
                    
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <h5 class="font-semibold text-green-800 mb-2">✅ Data Template Siap Pakai:</h5>
                        <p class="text-green-700 mb-2"><strong>Klik "Copy" → Paste di Google Sheets A1 → Otomatis jadi kolom!</strong></p>
                        <div class="relative">
                            <button onclick="copySimpleDataToClipboard()" class="absolute top-2 right-2 bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700 z-10">
                                📋 Copy Data
                            </button>
                            <textarea id="simpleSpreadsheetData" readonly class="w-full h-48 p-3 bg-white border rounded font-mono text-xs resize-none overflow-auto">Kategori	Judul	Deskripsi
Kurikulum	Kurikulum Merdeka	Implementasi kurikulum terbaru dengan pendekatan student-centered learning
Kurikulum	Mata Pelajaran Agama	Al-Quran Hadits Akidah Akhlak Fiqh dan Sejarah Kebudayaan Islam
Kurikulum	Mata Pelajaran Umum	Matematika IPA IPS Bahasa Indonesia dan Bahasa Inggris
Kurikulum	Program Tahfidz	Program menghafal Al-Quran dengan metode yang mudah dan menyenangkan
Kesiswaan	Pendaftaran Siswa Baru	Informasi lengkap proses penerimaan siswa baru tahun ajaran 2024/2025
Kesiswaan	Tata Tertib Sekolah	Peraturan dan tata tertib yang harus dipatuhi oleh seluruh siswa
Kesiswaan	Organisasi Siswa	OSIS MPK dan berbagai organisasi siswa sebagai wadah kepemimpinan
Kesiswaan	Prestasi Siswa	Daftar prestasi akademik dan non-akademik di berbagai kompetisi
Fasilitas	Ruang Kelas	32 ruang kelas ber-AC dengan fasilitas multimedia dan akses internet
Fasilitas	Laboratorium	Lab IPA Lab Komputer dan Lab Bahasa dengan peralatan modern
Fasilitas	Perpustakaan	Koleksi 5000+ buku referensi dan ruang baca yang nyaman
Fasilitas	Masjid	Masjid dengan kapasitas 500 jamaah untuk kegiatan ibadah
Fasilitas	Lapangan Olahraga	Lapangan basket voli dan sepak bola untuk kegiatan olahraga
Guru	Profil Guru	Tim pengajar berpengalaman dengan kualifikasi S1 dan S2 bersertifikat
Guru	Pengembangan Profesi	Program pelatihan dan sertifikasi guru berkelanjutan
Guru	Struktur Organisasi	Susunan kepemimpinan dan struktur organisasi sekolah
Guru	Prestasi Guru	Penghargaan dan prestasi yang diraih para pendidik
Kegiatan	Agenda Bulanan	Kalender kegiatan dan acara sekolah setiap bulan
Kegiatan	Peringatan Hari Besar	Perayaan hari besar Islam dan nasional
Kegiatan	Study Tour	Program kunjungan edukatif ke tempat bersejarah
Kegiatan	Lomba dan Kompetisi	Berbagai kompetisi akademik dan non-akademik
Kegiatan	Pesantren Kilat	Program pesantren kilat selama bulan Ramadan
Informasi	Pengumuman Terbaru	Informasi dan pengumuman penting dari sekolah
Informasi	Berita Sekolah	Berita dan artikel tentang kegiatan sekolah
Informasi	Galeri Foto	Dokumentasi kegiatan dan momen penting sekolah
Informasi	Kontak Darurat	Nomor telepon penting dan kontak darurat
Informasi	Jadwal Pelajaran	Jadwal pelajaran harian dan mingguan
Informasi	Kalender Akademik	Kalender akademik tahunan dengan jadwal libur</textarea>
                        </div>
                        <div id="copySimpleMessage" class="mt-2 text-green-600 text-sm hidden">✅ Data berhasil di-copy! Paste di Google Sheets cell A1</div>
                    </div>
                </div>
                
                <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <h5 class="font-semibold text-yellow-800 mb-2">🎨 Icon & Warna Otomatis:</h5>
                    <div class="grid grid-cols-2 gap-3 text-xs">
                        <div><span class="text-green-600">📚 Kurikulum</span> → Hijau</div>
                        <div><span class="text-blue-600">👥 Kesiswaan</span> → Biru</div>
                        <div><span class="text-purple-600">🏢 Fasilitas</span> → Ungu</div>
                        <div><span class="text-orange-600">👨‍🏫 Guru</span> → Orange</div>
                        <div><span class="text-red-600">🎉 Kegiatan</span> → Merah</div>
                        <div><span class="text-teal-600">ℹ️ Informasi</span> → Teal</div>
                    </div>
                    <p class="text-yellow-700 text-sm mt-2">
                        <strong>💡 Tips:</strong> Tambah baris baru = item baru otomatis muncul! Sistem akan otomatis mendeteksi kategori dan memberikan icon + warna yang sesuai.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="container mx-auto px-6">
            <div class="grid md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center space-x-3 mb-4">
                        <span class="text-2xl">🕌</span>
                        <h4 class="text-xl font-bold">Madrasah Hasyim Asy'ari 1 Kudus</h4>
                    </div>
                    <p class="text-gray-300">Lembaga pendidikan Islam terpercaya yang telah berdiri sejak 1985</p>
                </div>
                <div>
                    <h5 class="font-semibold mb-4">Kontak</h5>
                    <div class="space-y-2 text-gray-300">
                        <p>📍 Jl. KH. Hasyim Asy'ari No. 15, Kudus</p>
                        <p>📞 (0291) 438-567</p>
                        <p>✉️ info@mhasyim1kudus.sch.id</p>
                    </div>
                </div>
                <div>
                    <h5 class="font-semibold mb-4">Jam Operasional</h5>
                    <div class="space-y-2 text-gray-300">
                        <p>Senin - Jumat: 07:00 - 15:00</p>
                        <p>Sabtu: 07:00 - 12:00</p>
                        <p>Minggu: Libur</p>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-300">
                <p>&copy; 2024 Madrasah Hasyim Asy'ari 1 Kudus. Semua hak dilindungi.</p>
            </div>
        </div>
    </footer>

    <script>
        // Database configuration - URL Google Sheets (default demo)
        let SPREADSHEET_URL = 'https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/export?format=csv';

        // Categories - hanya dari Google Sheets
        let categories = {};

        // Function to copy data to clipboard
        function copyDataToClipboard() {
            const textarea = document.getElementById('spreadsheetData');
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                const message = document.getElementById('copyMessage');
                message.classList.remove('hidden');
                setTimeout(() => {
                    message.classList.add('hidden');
                }, 3000);
            } catch (err) {
                alert('Gagal copy data. Silakan copy manual dari kotak teks.');
            }
        }

        // Function to copy simple data to clipboard
        function copySimpleDataToClipboard() {
            const textarea = document.getElementById('simpleSpreadsheetData');
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices
            
            try {
                document.execCommand('copy');
                const message = document.getElementById('copySimpleMessage');
                message.classList.remove('hidden');
                setTimeout(() => {
                    message.classList.add('hidden');
                }, 3000);
            } catch (err) {
                alert('Gagal copy data. Silakan copy manual dari kotak teks.');
            }
        }

        // Function to parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim()) {
                    const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    data.push(row);
                }
            }
            return data;
        }

        // Function to load data from spreadsheet
        async function loadDataFromSpreadsheet() {
            try {
                showLoadingMessage();
                console.log('Mencoba memuat data dari:', SPREADSHEET_URL);
                
                // Auto-fix URL before loading
                const originalUrl = SPREADSHEET_URL;
                SPREADSHEET_URL = fixSpreadsheetUrl(SPREADSHEET_URL);
                
                // Update input field and save if URL was fixed
                if (SPREADSHEET_URL !== originalUrl) {
                    document.getElementById('spreadsheetUrlInput').value = SPREADSHEET_URL;
                    localStorage.setItem('madrasah_spreadsheet_url', SPREADSHEET_URL);
                    console.log('🔧 URL otomatis diperbaiki saat loading data');
                }
                
                // Load data from single spreadsheet
                const response = await fetch(SPREADSHEET_URL);
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const csvText = await response.text();
                    console.log('CSV data received:', csvText.substring(0, 200) + '...');
                    
                    if (csvText.trim() === '' || csvText.includes('<!DOCTYPE html>')) {
                        throw new Error('Spreadsheet kosong atau belum dipublish dengan benar');
                    }
                    
                    const data = parseCSV(csvText);
                    console.log('Parsed data:', data);
                    
                    if (data.length === 0) {
                        throw new Error('Tidak ada data yang valid di spreadsheet');
                    }
                    
                    // Process and structure the data
                    categories = processSimpleSpreadsheetData(data);
                    console.log('Processed categories:', categories);
                    
                    if (Object.keys(categories).length === 0) {
                        throw new Error('Tidak ada kategori yang valid ditemukan');
                    }
                    
                    hideLoadingMessage();
                    renderCategories();
                    console.log('✅ Data berhasil dimuat dari spreadsheet');
                } else {
                    throw new Error(`HTTP Error: ${response.status} - ${response.statusText}`);
                }
            } catch (error) {
                console.error('❌ Error loading spreadsheet:', error.message);
                hideLoadingMessage();
                showDetailedErrorMessage(error.message);
            }
        }

        // Function to process simple spreadsheet data into categories structure
        function processSimpleSpreadsheetData(data) {
            const processedCategories = {};
            
            // Auto color and icon mapping based on category name
            const categoryMapping = {
                'kurikulum': { color: 'bg-green-500', icon: '📚' },
                'kesiswaan': { color: 'bg-blue-500', icon: '👥' },
                'siswa': { color: 'bg-blue-500', icon: '👥' },
                'fasilitas': { color: 'bg-purple-500', icon: '🏢' },
                'guru': { color: 'bg-orange-500', icon: '👨‍🏫' },
                'pendidik': { color: 'bg-orange-500', icon: '👨‍🏫' },
                'tenaga': { color: 'bg-orange-500', icon: '👨‍🏫' },
                'kegiatan': { color: 'bg-red-500', icon: '🎉' },
                'informasi': { color: 'bg-teal-500', icon: 'ℹ️' },
                'info': { color: 'bg-teal-500', icon: 'ℹ️' }
            };
            
            // Process each row
            data.forEach(row => {
                // Support multiple column name formats
                const categoryName = row['Kategori'] || row['kategori'] || row['Category'] || row['category'];
                const itemTitle = row['Judul'] || row['judul'] || row['Judul Item'] || row['judul_item'] || row['Title'] || row['title'];
                const itemDesc = row['Deskripsi'] || row['deskripsi'] || row['Description'] || row['description'];
                
                if (categoryName && itemTitle) {
                    // Create category key from name
                    const categoryKey = categoryName.toLowerCase().replace(/\s+/g, '_');
                    
                    // Initialize category if not exists
                    if (!processedCategories[categoryKey]) {
                        // Auto-detect category style based on name
                        let categoryStyle = { color: 'bg-gray-500', icon: '📁' };
                        
                        const lowerCategoryName = categoryName.toLowerCase();
                        for (const [keyword, style] of Object.entries(categoryMapping)) {
                            if (lowerCategoryName.includes(keyword)) {
                                categoryStyle = style;
                                break;
                            }
                        }
                        
                        processedCategories[categoryKey] = {
                            title: categoryName,
                            icon: categoryStyle.icon,
                            color: categoryStyle.color,
                            items: []
                        };
                    }
                    
                    // Auto-generate item icon based on title
                    let itemIcon = '📄';
                    const lowerTitle = itemTitle.toLowerCase();
                    if (lowerTitle.includes('kurikulum')) itemIcon = '🎯';
                    else if (lowerTitle.includes('agama') || lowerTitle.includes('islam')) itemIcon = '☪️';
                    else if (lowerTitle.includes('tahfidz') || lowerTitle.includes('quran')) itemIcon = '📖';
                    else if (lowerTitle.includes('pendaftaran') || lowerTitle.includes('daftar')) itemIcon = '📝';
                    else if (lowerTitle.includes('tata tertib') || lowerTitle.includes('peraturan')) itemIcon = '📋';
                    else if (lowerTitle.includes('organisasi') || lowerTitle.includes('osis')) itemIcon = '🤝';
                    else if (lowerTitle.includes('prestasi') || lowerTitle.includes('juara')) itemIcon = '🏅';
                    else if (lowerTitle.includes('kelas') || lowerTitle.includes('ruang')) itemIcon = '🏫';
                    else if (lowerTitle.includes('lab') || lowerTitle.includes('laboratorium')) itemIcon = '🔬';
                    else if (lowerTitle.includes('perpustakaan') || lowerTitle.includes('buku')) itemIcon = '📚';
                    else if (lowerTitle.includes('masjid') || lowerTitle.includes('mushola')) itemIcon = '🕌';
                    else if (lowerTitle.includes('olahraga') || lowerTitle.includes('lapangan')) itemIcon = '⚽';
                    else if (lowerTitle.includes('kantin') || lowerTitle.includes('makan')) itemIcon = '🍽️';
                    else if (lowerTitle.includes('guru') || lowerTitle.includes('pengajar')) itemIcon = '🎓';
                    else if (lowerTitle.includes('struktur') || lowerTitle.includes('organisasi')) itemIcon = '🏛️';
                    else if (lowerTitle.includes('agenda') || lowerTitle.includes('jadwal')) itemIcon = '📅';
                    else if (lowerTitle.includes('lomba') || lowerTitle.includes('kompetisi')) itemIcon = '🏆';
                    else if (lowerTitle.includes('pesantren') || lowerTitle.includes('ramadan')) itemIcon = '🌙';
                    else if (lowerTitle.includes('pengumuman')) itemIcon = '📢';
                    else if (lowerTitle.includes('berita')) itemIcon = '📰';
                    else if (lowerTitle.includes('foto') || lowerTitle.includes('galeri')) itemIcon = '📸';
                    else if (lowerTitle.includes('darurat') || lowerTitle.includes('kontak')) itemIcon = '🚨';
                    else if (lowerTitle.includes('kalender')) itemIcon = '📆';
                    
                    // Add item to category
                    processedCategories[categoryKey].items.push({
                        title: itemTitle,
                        desc: itemDesc || "Tidak ada deskripsi",
                        icon: itemIcon
                    });
                }
            });
            
            return processedCategories;
        }

        // Loading message functions
        function showLoadingMessage() {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"></div>
                    <p class="text-gray-600">Memuat data dari database...</p>
                </div>
            `;
        }

        function hideLoadingMessage() {
            // Loading message will be replaced by renderCategories()
        }

        function showErrorMessage() {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="text-6xl mb-4">📋</div>
                    <h4 class="text-2xl font-bold text-gray-800 mb-4">Belum Ada Data</h4>
                    <p class="text-gray-600 mb-6">Website ini menggunakan data dari Google Sheets.<br>Silakan isi data di spreadsheet terlebih dahulu.</p>
                    <button onclick="showAdminPanel()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                        ⚙️ Buka Panel Admin
                    </button>
                </div>
            `;
        }

        function showDetailedErrorMessage(errorMsg) {
            const grid = document.getElementById('categoriesGrid');
            let troubleshootingTips = '';
            
            if (errorMsg.includes('kosong') || errorMsg.includes('belum dipublish')) {
                troubleshootingTips = `
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mt-4 text-left">
                        <h5 class="font-semibold text-yellow-800 mb-2">🔧 Kemungkinan Masalah:</h5>
                        <ul class="text-yellow-700 text-sm space-y-1">
                            <li>• Spreadsheet belum dipublish ke web</li>
                            <li>• Spreadsheet masih kosong (belum ada data)</li>
                            <li>• URL masih menggunakan format "pubhtml" bukan "pub?output=csv"</li>
                        </ul>
                    </div>
                `;
            } else if (errorMsg.includes('HTTP Error')) {
                troubleshootingTips = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mt-4 text-left">
                        <h5 class="font-semibold text-red-800 mb-2">🚫 Error Koneksi:</h5>
                        <ul class="text-red-700 text-sm space-y-1">
                            <li>• URL spreadsheet tidak valid atau tidak dapat diakses</li>
                            <li>• Spreadsheet mungkin private (belum dipublish)</li>
                            <li>• Periksa kembali URL di panel admin</li>
                        </ul>
                    </div>
                `;
            } else {
                troubleshootingTips = `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4 text-left">
                        <h5 class="font-semibold text-blue-800 mb-2">ℹ️ Info Error:</h5>
                        <p class="text-blue-700 text-sm">${errorMsg}</p>
                    </div>
                `;
            }
            
            grid.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <div class="text-6xl mb-4">⚠️</div>
                    <h4 class="text-2xl font-bold text-gray-800 mb-4">Gagal Memuat Data</h4>
                    <p class="text-gray-600 mb-4">Terjadi masalah saat memuat data dari Google Sheets</p>
                    ${troubleshootingTips}
                    <div class="mt-6 space-x-3">
                        <button onclick="refreshData()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            🔄 Coba Lagi
                        </button>
                        <button onclick="showAdminPanel()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                            ⚙️ Buka Panel Admin
                        </button>
                    </div>
                    <p class="text-xs text-gray-500 mt-4">Buka Console Browser (F12) untuk melihat detail error</p>
                </div>
            `;
        }

        function renderCategories() {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = '';
            
            Object.keys(categories).forEach(key => {
                const category = categories[key];
                const card = document.createElement('div');
                card.className = `${category.color} text-white p-8 rounded-xl card-hover cursor-pointer`;
                card.innerHTML = `
                    <div class="text-4xl mb-4">${category.icon}</div>
                    <h4 class="text-2xl font-bold mb-3">${category.title}</h4>
                    <p class="text-white/90 mb-4">Klik untuk melihat detail informasi ${category.title.toLowerCase()}</p>
                    <div class="flex items-center text-white/80">
                        <span class="mr-2">Lihat Detail</span>
                        <span>→</span>
                    </div>
                `;
                card.addEventListener('click', () => showCategory(key));
                grid.appendChild(card);
            });
        }

        function showCategory(categoryKey) {
            const category = categories[categoryKey];
            const contentSection = document.getElementById('contentSection');
            const contentTitle = document.getElementById('contentTitle');
            const contentArea = document.getElementById('contentArea');
            
            contentTitle.textContent = category.title;
            contentArea.innerHTML = '';
            
            category.items.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = 'bg-white p-6 rounded-lg shadow-md border border-gray-200 card-hover';
                itemCard.innerHTML = `
                    <div class="flex items-start space-x-4">
                        <div class="text-3xl">${item.icon}</div>
                        <div class="flex-1">
                            <h5 class="text-xl font-semibold text-gray-800 mb-2">${item.title}</h5>
                            <p class="text-gray-600">${item.desc}</p>
                            <button class="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm">
                                Pelajari Lebih Lanjut
                            </button>
                        </div>
                    </div>
                `;
                contentArea.appendChild(itemCard);
            });
            
            // Hide categories section and search section
            document.getElementById('categoriesSection').style.display = 'none';
            document.querySelector('.py-8.bg-gray-100').style.display = 'none';
            document.getElementById('searchResults').classList.add('hidden');
            
            // Show content section
            contentSection.style.display = 'block';
            
            // Scroll to content
            contentSection.scrollIntoView({ behavior: 'smooth' });
        }

        function showCategories() {
            // Show categories section and search section
            document.getElementById('categoriesSection').style.display = 'block';
            document.querySelector('.py-8.bg-gray-100').style.display = 'block';
            
            // Hide content section
            document.getElementById('contentSection').style.display = 'none';
            
            // Clear search results
            document.getElementById('searchResults').classList.add('hidden');
            document.getElementById('searchInput').value = '';
            
            // Scroll to categories
            document.getElementById('categoriesSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Search functionality
        function performSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            const searchResults = document.getElementById('searchResults');
            const searchResultsList = document.getElementById('searchResultsList');
            
            if (query === '') {
                searchResults.classList.add('hidden');
                return;
            }
            
            let results = [];
            
            // Search through categories and items
            Object.keys(categories).forEach(key => {
                const category = categories[key];
                
                // Check category title
                if (category.title.toLowerCase().includes(query)) {
                    results.push({
                        type: 'category',
                        title: category.title,
                        desc: `Kategori ${category.title}`,
                        action: () => showCategory(key)
                    });
                }
                
                // Check category items
                category.items.forEach(item => {
                    if (item.title.toLowerCase().includes(query) || item.desc.toLowerCase().includes(query)) {
                        results.push({
                            type: 'item',
                            title: item.title,
                            desc: item.desc,
                            category: category.title,
                            action: () => showCategory(key)
                        });
                    }
                });
            });
            
            // Display results
            if (results.length > 0) {
                searchResultsList.innerHTML = results.map(result => `
                    <div class="p-3 border-b border-gray-200 last:border-b-0 cursor-pointer hover:bg-gray-50" onclick="result.action()">
                        <div class="flex items-start space-x-3">
                            <span class="text-lg">${result.type === 'category' ? '📁' : '📄'}</span>
                            <div>
                                <h6 class="font-medium text-gray-800">${result.title}</h6>
                                <p class="text-sm text-gray-600">${result.desc}</p>
                                ${result.category ? `<span class="text-xs text-green-600">dalam ${result.category}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
                searchResults.classList.remove('hidden');
            } else {
                searchResultsList.innerHTML = '<p class="text-gray-500 text-center py-4">Tidak ada hasil yang ditemukan</p>';
                searchResults.classList.remove('hidden');
            }
        }
        
        // Navigation functions
        function showHome() {
            // Hide all sections
            document.getElementById('contentSection').style.display = 'none';
            document.getElementById('aboutSection').style.display = 'none';
            document.getElementById('contactSection').style.display = 'none';
            document.getElementById('searchResults').classList.add('hidden');
            
            // Show home sections
            document.getElementById('categoriesSection').style.display = 'block';
            document.querySelector('.py-8.bg-gray-100').style.display = 'block';
            
            // Clear search
            document.getElementById('searchInput').value = '';
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function showAbout() {
            // Hide all sections
            document.getElementById('categoriesSection').style.display = 'none';
            document.getElementById('contentSection').style.display = 'none';
            document.getElementById('contactSection').style.display = 'none';
            document.querySelector('.py-8.bg-gray-100').style.display = 'none';
            
            // Show about section
            document.getElementById('aboutSection').style.display = 'block';
            
            // Scroll to section
            document.getElementById('aboutSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function showContact() {
            // Hide all sections
            document.getElementById('categoriesSection').style.display = 'none';
            document.getElementById('contentSection').style.display = 'none';
            document.getElementById('aboutSection').style.display = 'none';
            document.querySelector('.py-8.bg-gray-100').style.display = 'none';
            
            // Show contact section
            document.getElementById('contactSection').style.display = 'block';
            
            // Scroll to section
            document.getElementById('contactSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Event listeners
        document.getElementById('backButton').addEventListener('click', showCategories);
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Admin panel functions
        function showAdminPanel() {
            const adminPanel = document.getElementById('adminPanel');
            adminPanel.style.display = 'block';
            adminPanel.scrollIntoView({ behavior: 'smooth' });
        }

        function hideAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }

        function refreshData() {
            loadDataFromSpreadsheet();
        }

        function updateSpreadsheetUrl() {
            const url = document.getElementById('spreadsheetUrlInput').value.trim();
            
            if (url) {
                SPREADSHEET_URL = url;
                
                // Save to localStorage
                localStorage.setItem('madrasah_spreadsheet_url', url);
                
                alert('URL spreadsheet berhasil disimpan! Klik "Refresh Data" untuk memuat data terbaru.');
            } else {
                alert('Mohon isi URL spreadsheet terlebih dahulu.');
            }
        }

        // Function to automatically fix common URL format issues
        function fixSpreadsheetUrl(url) {
            console.log('🔧 Original URL:', url);
            
            // Remove any trailing spaces or newlines
            url = url.trim();
            
            // Handle the specific PACX format that's causing 400 errors
            if (url.includes('/e/2PACX-')) {
                console.log('🔧 Detected PACX format URL - rebuilding...');
                
                // Extract the PACX ID
                const pacxMatch = url.match(/\/e\/(2PACX-[a-zA-Z0-9-_]+)/);
                if (pacxMatch) {
                    const pacxId = pacxMatch[1];
                    // Build the correct export URL format
                    url = `https://docs.google.com/spreadsheets/d/e/${pacxId}/pub?output=csv`;
                    console.log('🔧 Rebuilt PACX URL:', url);
                    return url;
                }
            }
            
            // Fix common URL format issues
            if (url.includes('/pubhtml')) {
                // Replace pubhtml with pub?output=csv
                url = url.replace('/pubhtml', '/pub?output=csv');
                console.log('🔧 Fixed pubhtml → pub?output=csv');
            }
            
            if (url.includes('?gid=') && !url.includes('output=csv')) {
                // Add output=csv parameter
                url = url.replace('?gid=', '?output=csv&gid=');
                console.log('🔧 Added output=csv parameter');
            }
            
            if (url.includes('/edit#gid=') || url.includes('/edit?usp=')) {
                // Convert edit URL to publish URL
                const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                if (match) {
                    const spreadsheetId = match[1];
                    url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/pub?output=csv`;
                    console.log('🔧 Converted edit URL to publish URL');
                }
            }
            
            // Handle regular spreadsheet ID format
            if (!url.includes('pub?output=csv') && url.includes('spreadsheets/d/')) {
                const match = url.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                if (match) {
                    const spreadsheetId = match[1];
                    url = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/pub?output=csv`;
                    console.log('🔧 Rebuilt URL with correct format');
                }
            }
            
            console.log('✅ Fixed URL:', url);
            return url;
        }

        async function testSpreadsheetUrl() {
            let url = document.getElementById('spreadsheetUrlInput').value.trim();
            
            if (!url) {
                alert('Mohon isi URL spreadsheet terlebih dahulu.');
                return;
            }
            
            // Auto-fix the URL
            const originalUrl = url;
            url = fixSpreadsheetUrl(url);
            
            // Update the input field if URL was changed
            if (url !== originalUrl) {
                document.getElementById('spreadsheetUrlInput').value = url;
                console.log('🔧 URL otomatis diperbaiki dari:', originalUrl);
                console.log('🔧 URL baru:', url);
            }
            
            // Try multiple URL formats for PACX URLs
            const urlsToTry = [url];
            
            // If it's a PACX URL, try alternative formats
            if (url.includes('2PACX-')) {
                const pacxMatch = url.match(/(2PACX-[a-zA-Z0-9-_]+)/);
                if (pacxMatch) {
                    const pacxId = pacxMatch[1];
                    // Try different export formats
                    urlsToTry.push(`https://docs.google.com/spreadsheets/d/e/${pacxId}/export?format=csv`);
                    urlsToTry.push(`https://docs.google.com/spreadsheets/d/e/${pacxId}/export?format=csv&gid=0`);
                    urlsToTry.push(`https://docs.google.com/spreadsheets/d/e/${pacxId}/pub?gid=0&single=true&output=csv`);
                }
            }
            
            console.log('🧪 Will try these URLs:', urlsToTry);
            
            for (let i = 0; i < urlsToTry.length; i++) {
                const testUrl = urlsToTry[i];
                console.log(`🧪 Testing URL ${i + 1}/${urlsToTry.length}:`, testUrl);
                
                try {
                    const response = await fetch(testUrl);
                    console.log('📊 Response status:', response.status);
                    
                    if (response.ok) {
                        const text = await response.text();
                        console.log('📄 Response content (first 500 chars):', text.substring(0, 500));
                        
                        if (text.trim() === '') {
                            console.log('⚠️ Empty response, trying next URL...');
                            continue;
                        } else if (text.includes('<!DOCTYPE html>')) {
                            console.log('⚠️ HTML response, trying next URL...');
                            continue;
                        } else {
                            // Success! Update the URL field with working URL
                            document.getElementById('spreadsheetUrlInput').value = testUrl;
                            SPREADSHEET_URL = testUrl;
                            
                            let message = `✅ URL berhasil! Data CSV ditemukan.`;
                            if (testUrl !== originalUrl) {
                                message += `\n\n🔧 URL telah diperbaiki otomatis!`;
                                message += `\nURL asli: ${originalUrl.substring(0, 50)}...`;
                                message += `\nURL baru: ${testUrl.substring(0, 50)}...`;
                            }
                            
                            if (text.includes('Kategori') || text.includes('kategori')) {
                                message += '\n\n✅ Format data terdeteksi benar!';
                            } else {
                                message += '\n\n⚠️ Data ditemukan tapi pastikan format sesuai panduan.';
                            }
                            
                            message += '\n\nKlik "Simpan URL" lalu "Refresh Data" untuk memuat data ke website.';
                            alert(message);
                            return;
                        }
                    } else {
                        console.log(`❌ Status ${response.status}, trying next URL...`);
                        continue;
                    }
                } catch (error) {
                    console.log(`❌ Error with URL ${i + 1}: ${error.message}`);
                    continue;
                }
            }
            
            // If we get here, all URLs failed
            alert(`❌ Semua format URL gagal diakses!\n\nKemungkinan masalah:\n1. Spreadsheet belum di-publish ke web dengan benar\n2. Spreadsheet masih private\n3. ID spreadsheet tidak valid\n\n💡 Solusi:\n1. Buka Google Sheets\n2. File → Share → Publish to web\n3. Pilih "Entire Document" dan "Comma-separated values (.csv)"\n4. Klik "Publish" dan copy URL yang muncul\n5. Paste URL tersebut di sini\n\nURL yang dicoba:\n${urlsToTry.map((u, i) => `${i + 1}. ${u.substring(0, 60)}...`).join('\n')}`);
        }

        function loadSavedUrl() {
            const savedUrl = localStorage.getItem('madrasah_spreadsheet_url');
            
            if (savedUrl) {
                SPREADSHEET_URL = savedUrl;
                document.getElementById('spreadsheetUrlInput').value = savedUrl;
            }
        }

        // Initialize
        loadSavedUrl();
        loadDataFromSpreadsheet();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9751e0f7d1412035',t:'MTc1NjE5NjEwMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
