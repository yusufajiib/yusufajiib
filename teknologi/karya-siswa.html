<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galeri Karya AI Siswa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-8px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .filter-btn.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .rating-stars { color: #fbbf24; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-indigo-500">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="text-center">
                <h1 class="text-4xl font-bold text-gray-800 mb-2">üé® Galeri Karya AI Siswa</h1>
                <p class="text-lg text-gray-600">Showcase Game & Aplikasi Buatan Siswa dengan Canva AI</p>
            </div>
        </div>
    </header>

    <!-- Filters -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Filter Kategori:</h3>
            <div class="flex flex-wrap gap-3">
                <button onclick="filterProjects('all')" class="filter-btn active px-6 py-2 rounded-full text-white font-medium transition-all">
                    Semua Karya
                </button>
                <button onclick="filterProjects('game')" class="filter-btn px-6 py-2 rounded-full bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-all">
                    üéÆ Game
                </button>
                <button onclick="filterProjects('aplikasi')" class="filter-btn px-6 py-2 rounded-full bg-gray-200 text-gray-700 font-medium hover:bg-gray-300 transition-all">
                    üì± Aplikasi
                </button>
            </div>
        </div>

        <!-- Search Bar & Refresh -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-4">
                <div class="relative flex-1">
                    <input type="text" id="searchInput" placeholder="Cari berdasarkan nama siswa atau kelas..." 
                           class="w-full px-4 py-3 pl-12 border-2 border-gray-200 rounded-xl focus:border-indigo-500 focus:outline-none transition-colors">
                    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                        üîç
                    </div>
                </div>
                <button onclick="refreshData()" 
                        class="px-6 py-3 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-colors font-medium">
                    üîÑ Refresh Data
                </button>
            </div>
            <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                <p class="text-sm text-blue-700">
                    <strong>üìä Status Database:</strong> 
                    <span id="dbStatus" class="font-medium">Menunggu koneksi...</span>
                </p>
            </div>
        </div>

        <!-- Projects Grid -->
        <div id="projectsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- Projects will be populated here -->
        </div>

        <!-- No Results Message -->
        <div id="noResults" class="hidden text-center py-16">
            <div class="text-6xl mb-4">üòî</div>
            <h3 class="text-xl font-semibold text-gray-600 mb-2">Tidak ada karya yang ditemukan</h3>
            <p class="text-gray-500">Coba ubah filter atau kata kunci pencarian</p>
        </div>
    </div>

    <script>
        // Database Configuration
        const DATABASE_CONFIG = {
            // Replace with your Google Sheets ID (from the URL)
            SHEET_ID: '17MDc804lNUm_XwUM6hPj6Ui8T-JVtpxJCLq4XovVs0A',
            // Replace with your sheet name (tab name)
            SHEET_NAME: 'Sheet1',
            // Google Sheets API Key (get from Google Cloud Console)
            API_KEY: 'AIzaSyCAJWvsjw92iebZM54KZivepTpl_Q2gk70'
        };

        let projectsData = [];
        let isLoading = true;

        // Function to fetch data from Google Sheets
        async function fetchFromSpreadsheet() {
            try {
                updateDatabaseStatus('üîÑ Menghubungkan ke spreadsheet...', 'text-blue-600');
                showLoadingState();
                
                // Check if configuration is set
                if (DATABASE_CONFIG.SHEET_ID === 'YOUR_GOOGLE_SHEETS_ID_HERE' || 
                    DATABASE_CONFIG.API_KEY === 'YOUR_API_KEY_HERE') {
                    throw new Error('Database belum dikonfigurasi');
                }
                
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${DATABASE_CONFIG.SHEET_ID}/values/${DATABASE_CONFIG.SHEET_NAME}?key=${DATABASE_CONFIG.API_KEY}`;
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (!data.values || data.values.length < 2) {
                    throw new Error('No data found in spreadsheet');
                }
                
                // Convert spreadsheet data to project objects
                const headers = data.values[0];
                const rows = data.values.slice(1);
                
                projectsData = rows.map(row => {
                    const project = {};
                    headers.forEach((header, index) => {
                        const key = header.toLowerCase().replace(/\s+/g, '');
                        project[key] = row[index] || '';
                    });
                    
                    // Ensure required fields and convert data types
                    return {
                        timestamp: project.timestamp || new Date().toISOString().split('T')[0],
                        nama: project.nama || 'Unknown',
                        kelas: project.kelas || 'Unknown',
                        kategori: (project.kategori || 'aplikasi').toLowerCase(),
                        link: project.link || '#',
                        thumbnail: project.gambar || project.thumbnail || generateDefaultThumbnail(project.nama, project.kategori),
                        rating: parseFloat(project.rating) || 0,
                        versi: project.versi || '1.0'
                    };
                });
                
                updateDatabaseStatus(`‚úÖ Terhubung! ${projectsData.length} karya dimuat`, 'text-green-600');
                hideLoadingState();
                renderProjects();
                
            } catch (error) {
                console.error('Error fetching data:', error);
                updateDatabaseStatus('‚ùå Gagal terhubung ke database', 'text-red-600');
                handleDatabaseError(error);
            }
        }

        // Update database status indicator
        function updateDatabaseStatus(message, colorClass) {
            const statusElement = document.getElementById('dbStatus');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.className = `font-medium ${colorClass}`;
            }
        }

        // Function to generate default thumbnail if none provided
        function generateDefaultThumbnail(nama, kategori) {
            const colors = {
                game: '#4f46e5',
                aplikasi: '#06b6d4'
            };
            const icons = {
                game: 'üéÆ',
                aplikasi: 'üì±'
            };
            
            const color = colors[kategori] || '#6b7280';
            const icon = icons[kategori] || 'üìÑ';
            const title = `${icon} ${nama}`;
            
            return `data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200' viewBox='0 0 300 200'%3E%3Crect width='300' height='200' fill='${encodeURIComponent(color)}'/%3E%3Ctext x='150' y='100' text-anchor='middle' dy='0.35em' fill='white' font-size='18' font-family='Arial'%3E${encodeURIComponent(title)}%3C/text%3E%3C/svg%3E`;
        }

        // Show loading state
        function showLoadingState() {
            const grid = document.getElementById('projectsGrid');
            grid.innerHTML = `
                <div class="col-span-full flex flex-col items-center justify-center py-16">
                    <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-indigo-600 mb-4"></div>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">Memuat data dari database...</h3>
                    <p class="text-gray-500">Mengambil karya siswa terbaru</p>
                </div>
            `;
        }

        // Hide loading state
        function hideLoadingState() {
            isLoading = false;
        }

        // Handle database connection errors
        function handleDatabaseError(error) {
            const grid = document.getElementById('projectsGrid');
            const noResults = document.getElementById('noResults');
            
            // Check if it's a configuration error
            if (error.message.includes('Database belum dikonfigurasi')) {
                showConfigurationGuide();
                return;
            }
            
            grid.innerHTML = `
                <div class="col-span-full bg-red-50 border border-red-200 rounded-2xl p-8 text-center">
                    <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                    <h3 class="text-xl font-semibold text-red-800 mb-2">Gagal Terhubung ke Database</h3>
                    <p class="text-red-600 mb-4">Tidak dapat mengambil data dari spreadsheet</p>
                    <div class="bg-red-100 rounded-lg p-4 mb-4 text-left">
                        <p class="text-sm text-red-700 font-medium mb-2">Kemungkinan penyebab:</p>
                        <ul class="text-sm text-red-600 list-disc list-inside space-y-1">
                            <li>API Key tidak valid atau expired</li>
                            <li>Sheet ID tidak ditemukan</li>
                            <li>Spreadsheet tidak dapat diakses publik</li>
                            <li>Google Sheets API belum diaktifkan</li>
                            <li>Koneksi internet bermasalah</li>
                        </ul>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-3 justify-center">
                        <button onclick="showConfigurationGuide()" 
                                class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            üìñ Panduan Setup
                        </button>
                        <button onclick="retryConnection()" 
                                class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors">
                            üîÑ Coba Lagi
                        </button>
                    </div>
                </div>
            `;
            
            // Show demo data as fallback after 5 seconds
            setTimeout(() => {
                loadDemoData();
            }, 5000);
        }

        // Retry database connection
        function retryConnection() {
            fetchFromSpreadsheet();
        }

        // Load demo data as fallback
        function loadDemoData() {
            projectsData = [
                {
                    timestamp: "2024-01-15",
                    nama: "Andi Pratama",
                    kelas: "XII IPA 1",
                    kategori: "game",
                    link: "https://example.com/game1",
                    thumbnail: generateDefaultThumbnail("Space Adventure", "game"),
                    rating: 4.8,
                    versi: "1.2"
                },
                {
                    timestamp: "2024-01-14",
                    nama: "Sari Dewi",
                    kelas: "XI IPS 2",
                    kategori: "aplikasi",
                    link: "https://example.com/app1",
                    thumbnail: generateDefaultThumbnail("Study Planner", "aplikasi"),
                    rating: 4.5,
                    versi: "2.0"
                },
                {
                    timestamp: "2024-01-13",
                    nama: "Budi Santoso",
                    kelas: "XII IPA 2",
                    kategori: "game",
                    link: "https://example.com/game2",
                    thumbnail: generateDefaultThumbnail("Racing Pro", "game"),
                    rating: 4.7,
                    versi: "1.5"
                }
            ];
            
            const grid = document.getElementById('projectsGrid');
            grid.innerHTML = `
                <div class="col-span-full bg-yellow-50 border border-yellow-200 rounded-2xl p-6 text-center mb-8">
                    <div class="text-4xl mb-2">üìã</div>
                    <h3 class="text-lg font-semibold text-yellow-800 mb-1">Menampilkan Data Demo</h3>
                    <p class="text-yellow-600 text-sm">Konfigurasi database untuk melihat data asli dari spreadsheet</p>
                </div>
            `;
            
            renderProjects();
        }

        // Function to refresh data from spreadsheet
        function refreshData() {
            fetchFromSpreadsheet();
        }

        let currentFilter = 'all';
        let currentSearch = '';

        function renderProjects() {
            const grid = document.getElementById('projectsGrid');
            const noResults = document.getElementById('noResults');
            
            let filteredProjects = projectsData.filter(project => {
                const matchesFilter = currentFilter === 'all' || project.kategori === currentFilter;
                const matchesSearch = currentSearch === '' || 
                    project.nama.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    project.kelas.toLowerCase().includes(currentSearch.toLowerCase());
                return matchesFilter && matchesSearch;
            });

            if (filteredProjects.length === 0) {
                grid.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }

            noResults.classList.add('hidden');
            
            grid.innerHTML = filteredProjects.map(project => `
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                    <div class="relative">
                        <img src="${project.thumbnail}" alt="Thumbnail ${project.nama}" 
                             class="w-full h-48 object-cover"
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'300\\' height=\\'200\\' viewBox=\\'0 0 300 200\\'%3E%3Crect width=\\'300\\' height=\\'200\\' fill=\\'%23e5e7eb\\'/%3E%3Ctext x=\\'150\\' y=\\'100\\' text-anchor=\\'middle\\' dy=\\'0.35em\\' fill=\\'%236b7280\\' font-size=\\'16\\'%3ENo Image%3C/text%3E%3C/svg%3E';">
                        <div class="absolute top-4 right-4">
                            <span class="px-3 py-1 rounded-full text-xs font-medium ${project.kategori === 'game' ? 'bg-purple-100 text-purple-800' : 'bg-blue-100 text-blue-800'}">
                                ${project.kategori === 'game' ? 'üéÆ Game' : 'üì± Aplikasi'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-xl font-bold text-gray-800">${project.nama}</h3>
                            <span class="text-sm text-gray-500">v${project.versi}</span>
                        </div>
                        
                        <p class="text-gray-600 mb-4">
                            <span class="inline-flex items-center">
                                üéì ${project.kelas}
                            </span>
                        </p>
                        
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center">
                                <div class="rating-stars mr-2">
                                    ${generateStars(project.rating)}
                                </div>
                                <span class="text-sm font-medium text-gray-700">${project.rating}</span>
                            </div>
                            <span class="text-xs text-gray-500">${formatDate(project.timestamp)}</span>
                        </div>
                        
                        <button onclick="openProject('${project.link}')" 
                                class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 px-4 rounded-xl font-medium hover:from-indigo-600 hover:to-purple-700 transition-all transform hover:scale-105">
                            üöÄ Lihat Karya
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '‚≠ê';
            }
            if (hasHalfStar) {
                stars += '‚≠ê';
            }
            
            return stars;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', { 
                day: 'numeric', 
                month: 'short', 
                year: 'numeric' 
            });
        }

        function filterProjects(category) {
            currentFilter = category;
            
            // Update button styles
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                btn.classList.add('bg-gray-200', 'text-gray-700');
                btn.classList.remove('text-white');
            });
            
            event.target.classList.add('active');
            event.target.classList.remove('bg-gray-200', 'text-gray-700');
            event.target.classList.add('text-white');
            
            renderProjects();
        }

        function openProject(link) {
            // In a real implementation, this would open the actual project link
            alert(`Membuka karya: ${link}\n\nCatatan: Ini adalah demo. Dalam implementasi nyata, link akan membuka karya siswa yang sebenarnya.`);
        }

        // Search functionality
        document.getElementById('searchInput').addEventListener('input', function(e) {
            currentSearch = e.target.value;
            renderProjects();
        });

        // Initialize the application
        function initializeApp() {
            // Try to fetch from spreadsheet first
            fetchFromSpreadsheet();
        }

        // Show configuration guide
        function showConfigurationGuide() {
            const grid = document.getElementById('projectsGrid');
            grid.innerHTML = `
                <div class="col-span-full bg-blue-50 border border-blue-200 rounded-2xl p-8">
                    <div class="text-6xl mb-4 text-center">‚öôÔ∏è</div>
                    <h3 class="text-2xl font-bold text-blue-800 mb-4 text-center">Panduan Konfigurasi Database</h3>
                    
                    <div class="space-y-6">
                        <div class="bg-white rounded-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-3">üìã 1. Siapkan Google Spreadsheet</h4>
                            <ul class="text-sm text-gray-600 space-y-2 list-disc list-inside">
                                <li>Buat spreadsheet dengan kolom: <code class="bg-gray-100 px-2 py-1 rounded">timestamp, nama, kelas, kategori, link, gambar, rating, versi</code></li>
                                <li>Pastikan spreadsheet dapat diakses publik (Share ‚Üí Anyone with the link can view)</li>
                                <li>Salin ID spreadsheet dari URL (bagian setelah /d/ dan sebelum /edit)</li>
                            </ul>
                        </div>
                        
                        <div class="bg-white rounded-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-3">üîë 2. Dapatkan API Key Google Sheets</h4>
                            <ul class="text-sm text-gray-600 space-y-2 list-disc list-inside">
                                <li>Kunjungi <a href="https://console.cloud.google.com" target="_blank" class="text-blue-600 underline">Google Cloud Console</a></li>
                                <li>Buat project baru atau pilih project yang ada</li>
                                <li>Aktifkan Google Sheets API</li>
                                <li>Buat credentials (API Key)</li>
                                <li>Salin API Key yang dihasilkan</li>
                            </ul>
                        </div>
                        
                        <div class="bg-white rounded-lg p-6">
                            <h4 class="text-lg font-semibold text-gray-800 mb-3">üîß 3. Update Konfigurasi</h4>
                            <p class="text-sm text-gray-600 mb-3">Ganti nilai berikut di bagian DATABASE_CONFIG:</p>
                            <div class="bg-gray-100 p-4 rounded-lg text-sm font-mono">
                                <div>SHEET_ID: 'ID_SPREADSHEET_ANDA'</div>
                                <div>SHEET_NAME: 'Nama_Sheet' (default: Sheet1)</div>
                                <div>API_KEY: 'API_KEY_ANDA'</div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button onclick="retryConnection()" 
                                    class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium">
                                üîÑ Coba Koneksi Lagi
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initial render
        initializeApp();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9741df1846ddc613',t:'MTc1NjAyODI1MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>

